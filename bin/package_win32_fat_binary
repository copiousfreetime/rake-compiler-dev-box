#!/usr/bin/env bash

set -e

# prepare rubies for cross-compilation
prepare_xrubies

# shared directory between VM and host
cd '/vagrant'

# passed in path of gem to be cross-compiled
cd $1

source /usr/local/share/chruby/chruby.sh
base_version=${BASE_VERSION:-1.9.3}
cc_versions=${RUBY_CC_VERSION:-1.9.3:2.0.0:2.1.5}

# Use Ruby 1.9.3 as base to cross-compile to different versions
chruby $base_version
gem install bundler
bundle install

bundle exec rake clean clobber
bundle exec rake cross native gem RUBY_CC_VERSION=$cc_versions RUBYOPT=
